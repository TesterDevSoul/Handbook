# JMeter体系结构
## 本章要点
1. 要点一
1. 要点
1. 要点
1. 要点

## JMeter基本组件




### 八大组件

1. Sampler「**采样器/取样器**」
2. Logic Controller「**控制器**」
3. Config Elements「**配置元件**」
4. Timer「**定时器**」
5. Assertions「**断言**」
6. Listener「**监听器**」
7. Pre/Post-processors 「**前置/后置处理器**」
8. Thread Group「**线程组**」



#### 元件

元件代表JMeter工具菜单中一个子菜单/功能，比如：HTTP请求、JDBC 请求、事务控制器、响应断言等，就是一个元件。

>向百度服务器发送一个HTTP协议的GET请求，这个请求是由一个HTTP请求取样器来完成，这个HTTP请求取样器就是元件。

**在树状组件栏中添加进来的都是元件**。


#### 组件

一组元件的集合（一个/多个），比如逻辑控制器中有事务控制器、仅一次控制器、循环控制器等，这些都是元件。但是它们被归类到逻辑控制器中，**逻辑控制器**就是组件。


#### 元件VS组件

- 多个元件叫组件。

- 元件是JMeter中最小的添加的内容。

- 组件是一个元件的集合。



**不同的元件作用范围不同。**
>`Header Manager`可以影响全局所有的`Http Sampler`，也可以只影响某一个`Http Sampler`，看`Header Manager`所处位置的作用范围而决定。

**不同元件对应执行时序点也不同。**

>断言组件Assertions中查看结果树元件，就是为了校验请求是否通过。所以，Assertions元件一定是运行在Sample之后，如果上来就先运行断言组件对应的压测脚本是没有任何意义的。   




### JMeter结构图
下图描述了JMeter的体系结构，本篇文章根据体系结构来了解JMeter的组成。

![](https://cdn.jsdelivr.net/gh/TesterDevSoul/pic/manual/20230216140127.png)


上图是把八大组件拆成放在了一个三维空间中。其中X空间分为5个维度，Y空间分为2个维度，Z空间分为1个维度。

#### X1～X5

X1～X5这5个维度是负载模拟的一个过程。
>使用的就是X空间上这5个维度的组件来完成负载的模拟。

#### Y1

Y1维度是负载模拟的**部分**，主要负责的是模拟用户的请求。

#### Y2

Y2维度是对结果的一个验证，主要是负责验证负载的结果的正确性。

>测试用例的一个结果验证。

#### Z

Z维度是负载结果的收集，实际上只有一个组件**监听器**。

监听器不仅可以放在线程组组件内，也可以放在线程组组件外，所以在图中，线程组和监听器是相交的。


大家通过JMeter源码会发现，其实JMeter就是创建了一个大池子（线程池），然后使用**多线程**运行压测脚本的**取样器**，以此来对**被测服务器**产生大量负载。

在压测脚本运行过程中，发送请求后收到的响应会根据**Y2**维度的**断言**组件来验证结果的正确性，并通过**Z**维度的**监听器**来记录对应请求的测试结果。

如果**取样器**有**参数化**需求，则可通过**X2**维度中**配置元件**或者**前置处理器**来完成。

如果**取样器**有**关联**需求，则可通过**X2**维度中**后置处理器**来完成。

如果想要设置**运行场景**，比如**模拟多少用户**，**运行多长时间**，则直接设置**X5**维度中的**线程组**。

如果想要**模拟并发场景**，可以利用**X4**维度中的**定时器**。

如果想要**控制业务的执行逻辑**，比如登录的业务只运行一次，可以利用**X3**维度中的**控制器**。




### X1 取样器/采样器

`Sampler`也叫**采样器**或**取样器**，JMeter 可以使用采样器将特定类型的请求发送到服务器。

取样器主要是用来模拟用户的操作请求，比如向服务器发送HTTP请求、JDBC请求、Java请求等等。


>可以把HTTP请求元件看作一个没有界面的浏览器，它可以直接向服务器发送HTTP请求并接收服务器响应的数据。


JMeter中所有的组件都是为采样器进行服务的。

#### 常用Sampler

- HTTP 请求
- JDBC 请求
- Java 请求
- FTP请求
    
    ...

#### 访问路径

【测试计划】 -> 【线程组】 -> 【添加】-> 【取样器】

注意⚠️：取样器必须在线程组下才能添加。

![](https://cdn.jsdelivr.net/gh/TesterDevSoul/pic/manual/20230216153418.png)


### X1 断言

在 JMeter 中，断言主要是用来验证发送到服务器的请求的响应，就是用一个预期结果「值、表达式、时间长短等条件」与请求的实际结果进行匹配的过程。如果匹配上则成功，反之就失败。

>写过自动化用例的同学应该对断言这个含义不陌生，对应的每一个测试用例在运行完获取结果后都需要进行断言才能判断当前的用例是通过还是失败。

如果断言需要应用于特定的采样器（请求），则断言应放在采样器子级路径下。


##### 常用断言

- 响应断言
- Json断言
- BeanShell断言
- Xpath断言

    ...

#### 访问路径

【测试计划】 -> 【断言】

![](https://cdn.jsdelivr.net/gh/TesterDevSoul/pic/manual/20230216155406.png)

### X1 监听器

JMeter中运行的测试结果需要添加监听器来手机，监听器有2个任务：

1. 添加结果的监听，并可以保存测试结果到文件，这样结果数据可供再次分析使用。

2. 展示结果，监听器可以以不同的格式显示结果，例如树、表格、图形或日志文件；方便测试人员分析测试结果。

![](https://cdn.jsdelivr.net/gh/TesterDevSoul/pic/manual/Listners.png)

>开发脚本时，不可避免的就是调试，监听器也提供了辅助，比如：查看结果树，可以看到请求与响应数据。


监听器可以添加到测试计划列表下的任何地方。它会从其范围内定义的元件中收集结果数据。


#### 访问路径

【测试计划】 -> 【监听器】

![](https://cdn.jsdelivr.net/gh/TesterDevSoul/pic/manual/20230216155847.png)


### X1总结

【取样器】、【断言】、【监听器】组合在一起就可以帮助我们完成发送请求、验证结果及记录结果三项基本工作。

到此就可以使用以上组件来构建一个简单的压测脚本。

### X2 前置处理器 

前置处理器（Pre-processors）是在采样器执行之**前**运行的一类组件。

一般用来完成一些前置性的工作，所以经常用于在样本请求执行之前去修改样本请求的设置。

测试脚本开发过程中，在请求发送前可能会有一些环境或者参数的准备工作，那就可以用前置处理器来完成这些工作。

>比如 JDBC请求对数据库进行操作前需要建立一个数据库的连接，那前置处理器就可以完成这个数据库建立连接的功能。

#### 常用前置处理器

- 用户参数

- BeanShell 预处理程序

- JDBC 预处理程序

    ...

#### 访问路径

【测试计划】 -> 【前置处理器】

![](https://cdn.jsdelivr.net/gh/TesterDevSoul/pic/manual/20230216171139.png)




### X2 配置元件

为取样器提供**预备数据**，然后由取样器发出请求。「作用」

提供预备数据有：JMeter参数化、函数助手生成动态数据、记录服务器返回数据。

>使用**CSV 数据文件设置**进行JMeter参数化，可以从文件中读取测试数据。<br>使用`HTTP Cookie Manager`，自动记录服务器返回的`Cookie`信息。<br>使用`User Defined Variables`，预置一些初始化变量。




#### 访问路径

可以通过 测试计划 --> 配置元件 添加Config Element，线程组也可以添加配置元件。

【测试计划】 -> 【配置元件】

【测试计划】 -> 【线程组】-> 【配置元件】

![](https://cdn.jsdelivr.net/gh/TesterDevSoul/pic/manual/20230216175446.png)



### X2 后置处理器




后置处理器（Post-processors）是在采样器执行之**后**运行的一类组件。一般用来处理服务器的返回结果。

后置处理器专门用来对响应数据进行处理的组件。关联，JMeter的关联就是通过后置处理器来完成的。

可以通过 测试计划 --> 后置处理器 添加Post Processors，线程组也可以添加后置处理器。

可以通过 测试计划| 添加Post Processors。线程组也可以添加后置处理器。

它的作用是处理响应数据。比如正则表达式提取器（Regular Expression Extractor），使用正则表达式来匹配响应结果，提取部分数据。



#### 访问路径

可以通过 测试计划 --> 后置处理器 添加Post Processors，线程组也可以添加配置元件。

【测试计划】 -> 【后置处理器】

【测试计划】 -> 【线程组】-> 【后置处理器】

![](https://cdn.jsdelivr.net/gh/TesterDevSoul/pic/manual/20230216175446.png)

### X2总结

【前置处理器】、【配置元件】、【后置处理器】都是为了X1中的取样器**提供数据支持**，取样器关注的是对应的业务逻辑。

>就比如家人是我们的后盾，帮助我们解决工作以外的一切麻烦，让我们全身心的投入到自己的工作中。

### X3 控制器

控制器默认为逻辑控制器，主要对取样器组件起作用，用于控制脚本的执行流程。它用来控制线程中取样器的处理顺序，还可以更改来自其子元素的请求的顺序。

作用域：逻辑控制器只对其子组件有效。


#### 常用逻辑控制器

- 仅一次控制器
- 简单控制器
- 循环控制器
- 事务控制器
- foreach控制器
- if控制器


想要脚本中某一组请求比其他请求执行更多次，可以使用控制器来解决此目的。对应场景：接收邮件时，只需要登录一次邮箱就可以查看到多封邮件。app购物时，只需要登录一次就可以多次进行订单的付款。

上述场景如果想要在JMeter中实现，就需要对登录的次数进行控制。在JMeter中使用逻辑控制器中的**仅一次控制器**就可完成。

**简单控制器**是根据您的需要存储类似请求的唯一容器。除此之外，它们不提供任何逻辑。

与其他请求相比，**循环控制器**用于使您的请求组运行更多或更少的迭代。添加一个循环控制器并指定循环次数，此元件下的所有请求将执行指定的迭代次数。




#### 访问路径

可以通过 测试计划 --> 线程组 --> 逻辑控制器 添加。

【测试计划】 -> 【线程组】-> 【逻辑控制器】

![](https://cdn.jsdelivr.net/gh/TesterDevSoul/pic/manual/20230217164205.png)
